<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest Note</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .editor-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #editor {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
        }
        .word-count {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .health-bar {
            width: 100%;
            height: 20px;
            background-color: #f3f3f3;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        .health-bar-fill {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease-in-out;
            border-radius: 10px;
        }
        .health-value {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-align: right;
        }
        .settings-container {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .settings-container input[type="range"] {
            width: 200px;
        }
        .settings-container span {
            font-size: 14px;
            color: #666;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <h1>Quest Note</h1>
        <div class="settings-container">
            <label for="decay-rate">Health Decay Rate (words per second):</label>
            <input type="range" id="decay-rate" min="1" max="10" value="2" step="0.1">
            <span id="decay-rate-value">2.0</span> words/sec
        </div>
        <textarea id="editor" placeholder="Type your paragraphs here..."></textarea>
        <div class="word-count" id="word-count">0 words</div>
        <div class="health-bar">
            <div class="health-bar-fill" id="health-bar-fill" style="width: 100%"></div>
        </div>
        <div class="health-value" id="health-value">100%</div>
        <div class="controls">
            <button onclick="clearEditor()">Clear</button>
            <button onclick="saveParagraph()">Save</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/editor.js') }}"></script>
        const editor = document.getElementById('editor');
        const wordCount = document.getElementById('word-count');
        const healthBarFill = document.getElementById('health-bar-fill');
        const decayRateInput = document.getElementById('decay-rate');
        const decayRateValue = document.getElementById('decay-rate-value');
        let decayTimer;
        let lastWordCount = 0;
        let healthPercentage = 100;

        // Update decay rate value display
        decayRateInput.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value).toFixed(1);
            decayRateValue.textContent = value;
            updateDecayRate(value);
        });

        // Start with decay rate of 2.0 words/sec
        updateDecayRate(2.0);

        function updateDecayRate(rate) {
            // Clear existing timer
            if (decayTimer) {
                clearInterval(decayTimer);
            }

            // Create new timer
            decayTimer = setInterval(() => {
                // Calculate health loss based on decay rate
                const words = editor.value.trim().split(/\s+/).filter(Boolean).length;
                const healthLoss = rate * 0.1; // 100ms interval
                healthPercentage = Math.max(0, healthPercentage - healthLoss);

                // Update health bar and value display
                healthBarFill.style.width = `${healthPercentage}%`;
                const healthValueDisplay = document.getElementById('health-value');
                healthValueDisplay.textContent = `${Math.round(healthPercentage)}%`;
                
                // Change color based on health
                if (healthPercentage >= 75) {
                    healthBarFill.style.backgroundColor = '#4CAF50';
                } else if (healthPercentage >= 50) {
                    healthBarFill.style.backgroundColor = '#FFA500';
                } else {
                    healthBarFill.style.backgroundColor = '#FF4444';
                }

                // Reset health if words increase
                if (words > lastWordCount) {
                    healthPercentage = 100;
                    healthBarFill.style.width = '100%';
                    healthBarFill.style.backgroundColor = '#4CAF50';
                    healthValueDisplay.textContent = '100%';
                }
                lastWordCount = words;
            }, 100); // 100ms interval
        }

        // Update word count and health bar on input
        editor.addEventListener('input', updateWordCount);

        function updateWordCount() {
            const words = editor.value.trim().split(/\s+/).filter(Boolean);
            wordCount.textContent = `${words.length} words`;
        }

        function clearEditor() {
            if (confirm('Are you sure you want to clear the editor?')) {
                editor.value = '';
                updateWordCount();
                healthPercentage = 100;
                healthBarFill.style.width = '100%';
                healthBarFill.style.backgroundColor = '#4CAF50';
            }
        }

        function saveParagraph() {
            const text = editor.value.trim();
            if (!text) {
                alert('Please type something before saving');
                return;
            }

            // Here you can add code to save the paragraph to a database or file
            alert('Paragraph saved successfully!');
        }
    </script>
</body>
</html>
